!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("socket.io-client"),require("stream"),require("http"),require("url"),require("https"),require("zlib")):"function"==typeof define&&define.amd?define(["socket.io-client","stream","http","url","https","zlib"],t):(e=e||self).VoicenterEventsSDK=t(e.io,e.Stream,e.http,e.Url,e.https,e.zlib)}(this,(function(io,Stream,http,Url,https,zlib){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}io=io&&Object.prototype.hasOwnProperty.call(io,"default")?io.default:io,Stream=Stream&&Object.prototype.hasOwnProperty.call(Stream,"default")?Stream.default:Stream,http=http&&Object.prototype.hasOwnProperty.call(http,"default")?http.default:http,Url=Url&&Object.prototype.hasOwnProperty.call(Url,"default")?Url.default:Url,https=https&&Object.prototype.hasOwnProperty.call(https,"default")?https.default:https,zlib=zlib&&Object.prototype.hasOwnProperty.call(zlib,"default")?zlib.default:zlib;var eventTypes={LOGIN_STATUS:"loginStatus",LOGIN:"login",LOGIN_USER:"loginUser",LOGIN_CODE:"loginUserCode",LOGIN_ACCOUNT:"loginAccount",LOGIN_RESPONSE:"loginResponse",QUEUE_EVENT:"QueueEvent",QUEUES_UPDATED:"QueuesUpdated",DIALERS_UPDATED:"DialersUpdated",EXTENSION_EVENT:"ExtensionEvent",EXTENSION_UPDATED:"ExtensionsUpdated",ALL_EXTENSION_STATUS:"AllExtensionsStatus",CONNECT:"connect",CONNECT_ERROR:"connect_error",CONNECT_TIMEOUT:"connect_timeout",DISCONNECT:"disconnect",PONG:"pong",RECONNECT:"reconnect",RECONNECT_ATTEMPT:"reconnect_attempt",RESYNC:"resync",RECONNECTING:"reconnecting",RECONNECT_ERROR:"reconnect_error",RECONNECT_FAILED:"reconnect_failed",KEEP_ALIVE:"keepalive",KEEP_ALIVE_RESPONSE:"keepaliveResponse",CLOSE:"closeme",ERROR:"error"},defaultServers=[{URLID:59,Priority:5,Version:2,Domain:"monitor1.voicenter.co"},{URLID:3,Priority:4,Version:2,Domain:"monitor3.voicenter.co.il"},{URLID:4,Priority:3,Version:2,Domain:"monitor4.voicenter.co.il"},{URLID:11,Priority:2,Version:2,Domain:"monitor11.voicenter.co"},{URLID:5,Priority:0,Version:2,Domain:"monitor5.voicenter.co.il"}],Logger=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.debug=t.debug}return _createClass(e,[{key:"_log",value:function(e,t){var r=t?"".concat(e,", %c Data -> ").concat(JSON.stringify(t)):"".concat(e),o=(new Date).toUTCString();console.log("%c ".concat(o,": %c ").concat(r),"color: #276749;","color: #4299e1;","color: #2c3e50;")}},{key:"_error",value:function(e,t){var r=t?"".concat(e,", Data -> ").concat(JSON.stringify(t)):"".concat(e),o=(new Date).toUTCString();console.error("".concat(o,": ").concat(r))}},{key:"log",value:function(e,t){this.debug&&(e&&!t?this._log(e):this._log(e,t))}},{key:"error",value:function(e,t){this.debug&&(e&&!t?this._error(e):this._error(e,t))}}]),e}();function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var isObject_1=isObject,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}function getCjsExportFromNamespace(e){return e&&e.default||e}var freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=_freeGlobal||freeSelf||Function("return this")(),_root=root,now=function(){return _root.Date.now()},now_1=now,Symbol$1=_root.Symbol,_Symbol=Symbol$1,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=_Symbol?_Symbol.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty.call(e,symToStringTag),r=e[symToStringTag];try{e[symToStringTag]=void 0;var o=!0}catch(e){}var n=nativeObjectToString.call(e);return o&&(t?e[symToStringTag]=r:delete e[symToStringTag]),n}var _getRawTag=getRawTag,objectProto$1=Object.prototype,nativeObjectToString$1=objectProto$1.toString;function objectToString(e){return nativeObjectToString$1.call(e)}var _objectToString=objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag$1=_Symbol?_Symbol.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag$1&&symToStringTag$1 in Object(e)?_getRawTag(e):_objectToString(e)}var _baseGetTag=baseGetTag;function isObjectLike(e){return null!=e&&"object"==typeof e}var isObjectLike_1=isObjectLike,symbolTag="[object Symbol]";function isSymbol(e){return"symbol"==typeof e||isObjectLike_1(e)&&_baseGetTag(e)==symbolTag}var isSymbol_1=isSymbol,NAN=NaN,reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(e){if("number"==typeof e)return e;if(isSymbol_1(e))return NAN;if(isObject_1(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject_1(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var toNumber_1=toNumber,FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce(e,t,r){var o,n,i,s,a,c,l=0,u=!1,f=!1,h=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);function p(t){var r=o,i=n;return o=n=void 0,l=t,s=e.apply(i,r)}function d(e){return l=e,a=setTimeout(m,t),u?p(e):s}function y(e){var r=e-c;return void 0===c||r>=t||r<0||f&&e-l>=i}function m(){var e=now_1();if(y(e))return E(e);a=setTimeout(m,function(e){var r=t-(e-c);return f?nativeMin(r,i-(e-l)):r}(e))}function E(e){return a=void 0,h&&o?p(e):(o=n=void 0,s)}function v(){var e=now_1(),r=y(e);if(o=arguments,n=this,c=e,r){if(void 0===a)return d(c);if(f)return clearTimeout(a),a=setTimeout(m,t),p(c)}return void 0===a&&(a=setTimeout(m,t)),s}return t=toNumber_1(t)||0,isObject_1(r)&&(u=!!r.leading,i=(f="maxWait"in r)?nativeMax(toNumber_1(r.maxWait)||0,t):i,h="trailing"in r?!!r.trailing:h),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,o=c=n=a=void 0},v.flush=function(){return void 0===a?s:E(now_1())},v}var debounce_1=debounce,sdkEventReasons={NEWCALL:"NEWCALL",ANSWER:"ANSWER",HANGUP:"HANGUP"},offlineEvents=[eventTypes.CONNECT_ERROR,eventTypes.CONNECT_TIMEOUT,eventTypes.DISCONNECT,eventTypes.RECONNECT_ATTEMPT,eventTypes.RECONNECTING,eventTypes.RECONNECT_ERROR,eventTypes.RECONNECT_FAILED,sdkEventReasons.CLOSE];function isSocketOffline(e){var t=e.name;return offlineEvents.includes(t)}function onNewEvent(e){var t=e.eventData,r=e.store,o=e.extensionsModuleName,n=e.queuesModuleName,i=t.name,s=t.data;switch(r.commit("".concat(o,"/SET_IS_SOCKET_OFFLINE"),isSocketOffline(t)),i){case eventTypes.ALL_EXTENSION_STATUS:r.dispatch("".concat(o,"/setExtensions"),s.extensions);break;case eventTypes.EXTENSION_EVENT:var a=s.data;a.lastEvent={reason:s.reason,ivrid:s.ivruniqueid};var c=r.state[o].extensions.findIndex((function(e){return e.userID===a.userID}));-1!==c&&r.dispatch("".concat(o,"/updateExtension"),{index:c,extension:a});break;case eventTypes.LOGIN_STATUS:r.commit("".concat(o,"/SET_SERVER_TIME"),s),r.dispatch("".concat(n,"/setQueues"),s.queues);break;case eventTypes.QUEUE_EVENT:var l=s.data,u=(r.state[n].all||[]).findIndex((function(e){return e.QueueID===l.QueueID}));-1!==u&&r.dispatch("".concat(n,"/updateQueue"),{index:u,queue:l})}}var callStatuses={CALLING:100,HOLD:101},_mutations,ISRAEL_TIMEZONE_OFFSET=108e5,MINUTE=6e4,LOGOUT_STATUS=2,HOLD_STATUS="hold",types={SET_EXTENSIONS:"SET_EXTENSIONS",UPDATE_EXTENSIONS:"UPDATE_EXTENSIONS",SET_SERVER_TIME:"SET_SERVER_TIME",SET_IS_SOCKET_OFFLINE:"SET_IS_SOCKET_OFFLINE"},state={extensions:[],serverTime:null,serverDelta:0,serverOffset:0,isSocketOffline:!1,offlineSocketTimestamp:null},mutations=(_mutations={},_defineProperty(_mutations,types.SET_EXTENSIONS,(function(e,t){e.extensions=t})),_defineProperty(_mutations,types.UPDATE_EXTENSIONS,(function(e,t){var r=t.index,o=t.extension;e.extensions.splice(r,1,o)})),_defineProperty(_mutations,types.SET_SERVER_TIME,(function(e,t){e.serverOffset=60*t.servertimeoffset*1e3||ISRAEL_TIMEZONE_OFFSET,e.serverTime=1e3*t.servertime-e.serverOffset,e.serverDelta=(new Date).getTime()-e.serverTime})),_defineProperty(_mutations,types.SET_IS_SOCKET_OFFLINE,(function(e,t){e.isSocketOffline=t,e.offlineSocketTimestamp=t?(new Date).getTime():null})),_mutations),actions={setExtensions:async function(e,t){(0,e.commit)(types.SET_EXTENSIONS,t)},updateExtension:async function(e,t){(0,e.commit)(types.UPDATE_EXTENSIONS,t)}};function isCallOnHold(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.callstatus||"";return t=t.toLowerCase(),e.answered&&t===HOLD_STATUS}var getters={isSocketOffline:function(e){if(!e.offlineSocketTimestamp||isNaN(e.offlineSocketTimestamp))return!1;var t=(new Date).getTime();return e.isSocketOffline&&t-e.offlineSocketTimestamp>MINUTE},extensionsWithCalls:function(e){return function(t){var r=[];return e.extensions.forEach((function(e){e.calls.length>0&&(e.calls.filter(isCallOnHold).length?e.representativeStatus=callStatuses.HOLD:e.representativeStatus=callStatuses.CALLING),r.push(e)})),t?r.filter((function(e){return e.representativeStatus!==LOGOUT_STATUS})):r}},extensionCountByStatus:function(e,t){return function(e){return t.extensionsWithCalls.filter((function(t){return t.representativeStatus===e})).length||0}}},extensionsModule={namespaced:!0,state:state,mutations:mutations,actions:actions,getters:getters},_mutations$1,types$1={SET_QUEUES:"SET_QUEUES",UPDATE_QUEUES:"UPDATE_QUEUES"},state$1={all:[]},mutations$1=(_mutations$1={},_defineProperty(_mutations$1,types$1.SET_QUEUES,(function(e,t){e.all=t})),_defineProperty(_mutations$1,types$1.UPDATE_QUEUES,(function(e,t){var r=t.index,o=t.queue;e.all.splice(r,1,o)})),_mutations$1),actions$1={setQueues:async function(e,t){(0,e.commit)(types$1.SET_QUEUES,t)},updateQueue:async function(e,t){(0,e.commit)(types$1.UPDATE_QUEUES,t)}},getters$1={queueWithActiveCalls:function(e){return e.all.filter((function(e){return e.Calls.length}))},allQueueCalls:function(e,t){var r=[];return t.queueWithActiveCalls.forEach((function(e){var t=e.Calls||[];r.push.apply(r,_toConsumableArray(t))})),r},filterQueuesByIds:function(e){return function(t){return t&&Array.isArray(t)?e.all.filter((function(e){return t.includes(e.QueueID)})):e.all}}},queuesModule={namespaced:!0,state:state$1,mutations:mutations$1,actions:actions$1,getters:getters$1};function getServerWithHighestPriority(e){var t=null,r=Number.MAX_SAFE_INTEGER;return e.forEach((function(e){e.Priority<r&&(r=e.Priority,t=e)})),t}function isValidDate(e){return!isNaN(e.getTime())}function require$$0(e,t){return t=t||{},new Promise((function(r,o){var n=new XMLHttpRequest,i=[],s=[],a={},c=function(){return{ok:2==(n.status/100|0),statusText:n.statusText,status:n.status,url:n.responseURL,text:function(){return Promise.resolve(n.responseText)},json:function(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([n.response]))},clone:c,headers:{keys:function(){return i},entries:function(){return s},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var l in n.open(t.method||"get",e,!0),n.onload=function(){n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,r){i.push(t=t.toLowerCase()),s.push([t,r]),a[t]=a[t]?a[t]+","+r:r})),r(c())},n.onerror=o,n.withCredentials="include"==t.credentials,t.headers)n.setRequestHeader(l,t.headers[l]);n.send(t.body||null)}))}const Readable=Stream.Readable,BUFFER=Symbol("buffer"),TYPE=Symbol("type");class Blob$1{constructor(){this[TYPE]="";const e=arguments[0],t=arguments[1],r=[];let o=0;if(e){const t=e,n=Number(t.length);for(let e=0;e<n;e++){const n=t[e];let i;i=n instanceof Buffer?n:ArrayBuffer.isView(n)?Buffer.from(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?Buffer.from(n):n instanceof Blob$1?n[BUFFER]:Buffer.from("string"==typeof n?n:String(n)),o+=i.length,r.push(i)}}this[BUFFER]=Buffer.concat(r);let n=t&&void 0!==t.type&&String(t.type).toLowerCase();n&&!/[^\u0020-\u007E]/.test(n)&&(this[TYPE]=n)}get size(){return this[BUFFER].length}get type(){return this[TYPE]}text(){return Promise.resolve(this[BUFFER].toString())}arrayBuffer(){const e=this[BUFFER],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new Readable;return e._read=function(){},e.push(this[BUFFER]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],r=arguments[1];let o,n;o=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),n=void 0===r?e:r<0?Math.max(e+r,0):Math.min(r,e);const i=Math.max(n-o,0),s=this[BUFFER].slice(o,o+i),a=new Blob$1([],{type:arguments[2]});return a[BUFFER]=s,a}}function FetchError(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}let convert;Object.defineProperties(Blob$1.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(Blob$1.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),FetchError.prototype=Object.create(Error.prototype),FetchError.prototype.constructor=FetchError,FetchError.prototype.name="FetchError";try{convert=require("encoding").convert}catch(e){}const INTERNALS=Symbol("Body internals"),PassThrough=Stream.PassThrough;function Body(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.size;let n=void 0===o?0:o;var i=r.timeout;let s=void 0===i?0:i;null==e?e=null:isURLSearchParams(e)?e=Buffer.from(e.toString()):isBlob(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Stream||(e=Buffer.from(String(e)))),this[INTERNALS]={body:e,disturbed:!1,error:null},this.size=n,this.timeout=s,e instanceof Stream&&e.on("error",(function(e){const r="AbortError"===e.name?e:new FetchError(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[INTERNALS].error=r}))}function consumeBody(){var e=this;if(this[INTERNALS].disturbed)return Body.Promise.reject(new TypeError("body used already for: "+this.url));if(this[INTERNALS].disturbed=!0,this[INTERNALS].error)return Body.Promise.reject(this[INTERNALS].error);let t=this.body;if(null===t)return Body.Promise.resolve(Buffer.alloc(0));if(isBlob(t)&&(t=t.stream()),Buffer.isBuffer(t))return Body.Promise.resolve(t);if(!(t instanceof Stream))return Body.Promise.resolve(Buffer.alloc(0));let r=[],o=0,n=!1;return new Body.Promise((function(i,s){let a;e.timeout&&(a=setTimeout((function(){n=!0,s(new FetchError(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))}),e.timeout)),t.on("error",(function(t){"AbortError"===t.name?(n=!0,s(t)):s(new FetchError(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))})),t.on("data",(function(t){if(!n&&null!==t){if(e.size&&o+t.length>e.size)return n=!0,void s(new FetchError(`content size at ${e.url} over limit: ${e.size}`,"max-size"));o+=t.length,r.push(t)}})),t.on("end",(function(){if(!n){clearTimeout(a);try{i(Buffer.concat(r,o))}catch(t){s(new FetchError(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}}))}))}function convertBody(e,t){if("function"!=typeof convert)throw new Error("The package `encoding` must be installed to use the textConverted() function");const r=t.get("content-type");let o,n,i="utf-8";return r&&(o=/charset=([^;]*)/i.exec(r)),n=e.slice(0,1024).toString(),!o&&n&&(o=/<meta.+?charset=(['"])(.+?)\1/i.exec(n)),!o&&n&&(o=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(n),o||(o=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(n),o&&o.pop()),o&&(o=/charset=(.*)/i.exec(o.pop()))),!o&&n&&(o=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(n)),o&&(i=o.pop(),"gb2312"!==i&&"gbk"!==i||(i="gb18030")),convert(e,"UTF-8",i).toString()}function isURLSearchParams(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function isBlob(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function clone(e){let t,r,o=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof Stream&&"function"!=typeof o.getBoundary&&(t=new PassThrough,r=new PassThrough,o.pipe(t),o.pipe(r),e[INTERNALS].body=t,o=r),o}function extractContentType(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":isURLSearchParams(e)?"application/x-www-form-urlencoded;charset=UTF-8":isBlob(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?"multipart/form-data;boundary="+e.getBoundary():e instanceof Stream?null:"text/plain;charset=UTF-8"}function getTotalBytes(e){const t=e.body;return null===t?0:isBlob(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}function writeToStream(e,t){const r=t.body;null===r?e.end():isBlob(r)?r.stream().pipe(e):Buffer.isBuffer(r)?(e.write(r),e.end()):r.pipe(e)}Body.prototype={get body(){return this[INTERNALS].body},get bodyUsed(){return this[INTERNALS].disturbed},arrayBuffer(){return consumeBody.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return consumeBody.call(this).then((function(t){return Object.assign(new Blob$1([],{type:e.toLowerCase()}),{[BUFFER]:t})}))},json(){var e=this;return consumeBody.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return Body.Promise.reject(new FetchError(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return consumeBody.call(this).then((function(e){return e.toString()}))},buffer(){return consumeBody.call(this)},textConverted(){var e=this;return consumeBody.call(this).then((function(t){return convertBody(t,e.headers)}))}},Object.defineProperties(Body.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),Body.mixIn=function(e){for(const t of Object.getOwnPropertyNames(Body.prototype))if(!(t in e)){const r=Object.getOwnPropertyDescriptor(Body.prototype,t);Object.defineProperty(e,t,r)}},Body.Promise=global.Promise;const invalidTokenRegex=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,invalidHeaderCharRegex=/[^\t\x20-\x7e\x80-\xff]/;function validateName(e){if(e=""+e,invalidTokenRegex.test(e)||""===e)throw new TypeError(e+" is not a legal HTTP header name")}function validateValue(e){if(e=""+e,invalidHeaderCharRegex.test(e))throw new TypeError(e+" is not a legal HTTP header value")}function find(e,t){t=t.toLowerCase();for(const r in e)if(r.toLowerCase()===t)return r}const MAP=Symbol("map");class Headers{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[MAP]=Object.create(null),e instanceof Headers){const t=e.raw(),r=Object.keys(t);for(const e of r)for(const r of t[e])this.append(e,r)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const r=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");r.push(Array.from(t))}for(const e of r){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const r=e[t];this.append(t,r)}}}}get(e){validateName(e=""+e);const t=find(this[MAP],e);return void 0===t?null:this[MAP][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=getHeaders(this),o=0;for(;o<r.length;){var n=r[o];const i=n[0],s=n[1];e.call(t,s,i,this),r=getHeaders(this),o++}}set(e,t){t=""+t,validateName(e=""+e),validateValue(t);const r=find(this[MAP],e);this[MAP][void 0!==r?r:e]=[t]}append(e,t){t=""+t,validateName(e=""+e),validateValue(t);const r=find(this[MAP],e);void 0!==r?this[MAP][r].push(t):this[MAP][e]=[t]}has(e){return validateName(e=""+e),void 0!==find(this[MAP],e)}delete(e){validateName(e=""+e);const t=find(this[MAP],e);void 0!==t&&delete this[MAP][t]}raw(){return this[MAP]}keys(){return createHeadersIterator(this,"key")}values(){return createHeadersIterator(this,"value")}[Symbol.iterator](){return createHeadersIterator(this,"key+value")}}function getHeaders(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const r=Object.keys(e[MAP]).sort();return r.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[MAP][t].join(", ")}:function(t){return[t.toLowerCase(),e[MAP][t].join(", ")]})}Headers.prototype.entries=Headers.prototype[Symbol.iterator],Object.defineProperty(Headers.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Headers.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const INTERNAL=Symbol("internal");function createHeadersIterator(e,t){const r=Object.create(HeadersIteratorPrototype);return r[INTERNAL]={target:e,kind:t,index:0},r}const HeadersIteratorPrototype=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==HeadersIteratorPrototype)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[INTERNAL];const t=e.target,r=e.kind,o=e.index,n=getHeaders(t,r);return o>=n.length?{value:void 0,done:!0}:(this[INTERNAL].index=o+1,{value:n[o],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function exportNodeCompatibleHeaders(e){const t=Object.assign({__proto__:null},e[MAP]),r=find(e[MAP],"Host");return void 0!==r&&(t[r]=t[r][0]),t}function createHeadersLenient(e){const t=new Headers;for(const r of Object.keys(e))if(!invalidTokenRegex.test(r))if(Array.isArray(e[r]))for(const o of e[r])invalidHeaderCharRegex.test(o)||(void 0===t[MAP][r]?t[MAP][r]=[o]:t[MAP][r].push(o));else invalidHeaderCharRegex.test(e[r])||(t[MAP][r]=[e[r]]);return t}Object.defineProperty(HeadersIteratorPrototype,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const INTERNALS$1=Symbol("Response internals"),STATUS_CODES=http.STATUS_CODES;class Response{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Body.call(this,e,t);const r=t.status||200,o=new Headers(t.headers);if(null!=e&&!o.has("Content-Type")){const t=extractContentType(e);t&&o.append("Content-Type",t)}this[INTERNALS$1]={url:t.url,status:r,statusText:t.statusText||STATUS_CODES[r],headers:o,counter:t.counter}}get url(){return this[INTERNALS$1].url||""}get status(){return this[INTERNALS$1].status}get ok(){return this[INTERNALS$1].status>=200&&this[INTERNALS$1].status<300}get redirected(){return this[INTERNALS$1].counter>0}get statusText(){return this[INTERNALS$1].statusText}get headers(){return this[INTERNALS$1].headers}clone(){return new Response(clone(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}Body.mixIn(Response.prototype),Object.defineProperties(Response.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(Response.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const INTERNALS$2=Symbol("Request internals"),parse_url=Url.parse,format_url=Url.format,streamDestructionSupported="destroy"in Stream.Readable.prototype;function isRequest(e){return"object"==typeof e&&"object"==typeof e[INTERNALS$2]}function isAbortSignal(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}class Request{constructor(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};isRequest(e)?t=parse_url(e.url):(t=e&&e.href?parse_url(e.href):parse_url(""+e),e={});let o=r.method||e.method||"GET";if(o=o.toUpperCase(),(null!=r.body||isRequest(e)&&null!==e.body)&&("GET"===o||"HEAD"===o))throw new TypeError("Request with GET/HEAD method cannot have body");let n=null!=r.body?r.body:isRequest(e)&&null!==e.body?clone(e):null;Body.call(this,n,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});const i=new Headers(r.headers||e.headers||{});if(null!=n&&!i.has("Content-Type")){const e=extractContentType(n);e&&i.append("Content-Type",e)}let s=isRequest(e)?e.signal:null;if("signal"in r&&(s=r.signal),null!=s&&!isAbortSignal(s))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[INTERNALS$2]={method:o,redirect:r.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:s},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[INTERNALS$2].method}get url(){return format_url(this[INTERNALS$2].parsedURL)}get headers(){return this[INTERNALS$2].headers}get redirect(){return this[INTERNALS$2].redirect}get signal(){return this[INTERNALS$2].signal}clone(){return new Request(this)}}function getNodeRequestOptions(e){const t=e[INTERNALS$2].parsedURL,r=new Headers(e[INTERNALS$2].headers);if(r.has("Accept")||r.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof Stream.Readable&&!streamDestructionSupported)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(o="0"),null!=e.body){const t=getTotalBytes(e);"number"==typeof t&&(o=String(t))}o&&r.set("Content-Length",o),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let n=e.agent;return"function"==typeof n&&(n=n(t)),r.has("Connection")||n||r.set("Connection","close"),Object.assign({},t,{method:e.method,headers:exportNodeCompatibleHeaders(r),agent:n})}function AbortError(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}Body.mixIn(Request.prototype),Object.defineProperty(Request.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Request.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),AbortError.prototype=Object.create(Error.prototype),AbortError.prototype.constructor=AbortError,AbortError.prototype.name="AbortError";const PassThrough$1=Stream.PassThrough,resolve_url=Url.resolve;function fetch(e,t){if(!fetch.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return Body.Promise=fetch.Promise,new fetch.Promise((function(r,o){const n=new Request(e,t),i=getNodeRequestOptions(n),s=("https:"===i.protocol?https:http).request,a=n.signal;let c=null;const l=function(){let e=new AbortError("The user aborted a request.");o(e),n.body&&n.body instanceof Stream.Readable&&n.body.destroy(e),c&&c.body&&c.body.emit("error",e)};if(a&&a.aborted)return void l();const u=function(){l(),p()},f=s(i);let h;function p(){f.abort(),a&&a.removeEventListener("abort",u),clearTimeout(h)}a&&a.addEventListener("abort",u),n.timeout&&f.once("socket",(function(e){h=setTimeout((function(){o(new FetchError("network timeout at: "+n.url,"request-timeout")),p()}),n.timeout)})),f.on("error",(function(e){o(new FetchError(`request to ${n.url} failed, reason: ${e.message}`,"system",e)),p()})),f.on("response",(function(e){clearTimeout(h);const t=createHeadersLenient(e.headers);if(fetch.isRedirect(e.statusCode)){const i=t.get("Location"),s=null===i?null:resolve_url(n.url,i);switch(n.redirect){case"error":return o(new FetchError("uri requested responds with a redirect, redirect mode is set to error: "+n.url,"no-redirect")),void p();case"manual":if(null!==s)try{t.set("Location",s)}catch(e){o(e)}break;case"follow":if(null===s)break;if(n.counter>=n.follow)return o(new FetchError("maximum redirect reached at: "+n.url,"max-redirect")),void p();const i={headers:new Headers(n.headers),follow:n.follow,counter:n.counter+1,agent:n.agent,compress:n.compress,method:n.method,body:n.body,signal:n.signal,timeout:n.timeout,size:n.size};return 303!==e.statusCode&&n.body&&null===getTotalBytes(n)?(o(new FetchError("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void p()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==n.method)||(i.method="GET",i.body=void 0,i.headers.delete("content-length")),r(fetch(new Request(s,i))),void p())}}e.once("end",(function(){a&&a.removeEventListener("abort",u)}));let i=e.pipe(new PassThrough$1);const s={url:n.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:n.size,timeout:n.timeout,counter:n.counter},l=t.get("Content-Encoding");if(!n.compress||"HEAD"===n.method||null===l||204===e.statusCode||304===e.statusCode)return c=new Response(i,s),void r(c);const f={flush:zlib.Z_SYNC_FLUSH,finishFlush:zlib.Z_SYNC_FLUSH};if("gzip"==l||"x-gzip"==l)return i=i.pipe(zlib.createGunzip(f)),c=new Response(i,s),void r(c);if("deflate"!=l&&"x-deflate"!=l){if("br"==l&&"function"==typeof zlib.createBrotliDecompress)return i=i.pipe(zlib.createBrotliDecompress()),c=new Response(i,s),void r(c);c=new Response(i,s),r(c)}else{e.pipe(new PassThrough$1).once("data",(function(e){i=8==(15&e[0])?i.pipe(zlib.createInflate()):i.pipe(zlib.createInflateRaw()),c=new Response(i,s),r(c)}))}})),writeToStream(f,n)}))}fetch.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},fetch.Promise=global.Promise;var lib=Object.freeze({__proto__:null,default:fetch,Headers:Headers,Request:Request,Response:Response,FetchError:FetchError}),require$$1=getCjsExportFromNamespace(lib);function r(e){return e&&e.default||e}var isomorphicUnfetch=commonjsGlobal.fetch=commonjsGlobal.fetch||("undefined"==typeof process?r(require$$0):function(e,t){return r(require$$1)(String(e).replace(/^\/\//g,"https://"),t)});async function externalLogin(e,t){var r=t.email,o=t.password,n=t.token,i=t.username,s=null;s=n?JSON.stringify({token:n}):i?JSON.stringify({username:i,password:o}):JSON.stringify({email:r,pin:o});var a=await isomorphicUnfetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:s}),c=await a.json();if(c.error)throw new Error(c.error);return c.Data.Socket}function getExternalLoginUrl(e,t){return"user"===t?"".concat(e,"/User"):"token"===t?"".concat(e,"/Token"):"account"===t?"".concat(e,"/Account"):e}async function refreshToken(e,t){return(await isomorphicUnfetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}})).json()}var md5=createCommonjsModule((function(module){
/**
   * [js-md5]{@link https://github.com/emn178/js-md5}
   *
   * @namespace md5
   * @version 0.7.3
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   */
!function(){var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=commonjsGlobal:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&module.exports,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e){return function(t){return new Md5(!0).update(t)[e]()}},createMethod=function(){var e=createOutputMethod("hex");NODE_JS&&(e=nodeWrap(e)),e.create=function(){return new Md5},e.update=function(t){return e.create().update(t)};for(var t=0;t<OUTPUT_TYPES.length;++t){var r=OUTPUT_TYPES[t];e[r]=createOutputMethod(r)}return e},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("md5").update(e,"utf8").digest("hex");if(null==e)throw ERROR;return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash("md5").update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod};function Md5(e){if(e)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"!==r)throw ERROR;if(null===e)throw ERROR;if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw ERROR;t=!0}for(var o,n,i=0,s=e.length,a=this.blocks,c=this.buffer8;i<s;){if(this.hashed&&(this.hashed=!1,a[0]=a[16],a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)if(ARRAY_BUFFER)for(n=this.start;i<s&&n<64;++i)c[n++]=e[i];else for(n=this.start;i<s&&n<64;++i)a[n>>2]|=e[i]<<SHIFT[3&n++];else if(ARRAY_BUFFER)for(n=this.start;i<s&&n<64;++i)(o=e.charCodeAt(i))<128?c[n++]=o:o<2048?(c[n++]=192|o>>6,c[n++]=128|63&o):o<55296||o>=57344?(c[n++]=224|o>>12,c[n++]=128|o>>6&63,c[n++]=128|63&o):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++i)),c[n++]=240|o>>18,c[n++]=128|o>>12&63,c[n++]=128|o>>6&63,c[n++]=128|63&o);else for(n=this.start;i<s&&n<64;++i)(o=e.charCodeAt(i))<128?a[n>>2]|=o<<SHIFT[3&n++]:o<2048?(a[n>>2]|=(192|o>>6)<<SHIFT[3&n++],a[n>>2]|=(128|63&o)<<SHIFT[3&n++]):o<55296||o>=57344?(a[n>>2]|=(224|o>>12)<<SHIFT[3&n++],a[n>>2]|=(128|o>>6&63)<<SHIFT[3&n++],a[n>>2]|=(128|63&o)<<SHIFT[3&n++]):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++i)),a[n>>2]|=(240|o>>18)<<SHIFT[3&n++],a[n>>2]|=(128|o>>12&63)<<SHIFT[3&n++],a[n>>2]|=(128|o>>6&63)<<SHIFT[3&n++],a[n>>2]|=(128|63&o)<<SHIFT[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=EXTRA[3&t],t>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var e,t,r,o,n,i,s=this.blocks;this.first?t=((t=((e=((e=s[0]-680876937)<<7|e>>>25)-271733879<<0)^(r=((r=(-271733879^(o=((o=(-1732584194^2004318071&e)+s[1]-117830708)<<12|o>>>20)+e<<0)&(-271733879^e))+s[2]-1126478375)<<17|r>>>15)+o<<0)&(o^e))+s[3]-1316259209)<<22|t>>>10)+r<<0:(e=this.h0,t=this.h1,r=this.h2,t=((t+=((e=((e+=((o=this.h3)^t&(r^o))+s[0]-680876936)<<7|e>>>25)+t<<0)^(r=((r+=(t^(o=((o+=(r^e&(t^r))+s[1]-389564586)<<12|o>>>20)+e<<0)&(e^t))+s[2]+606105819)<<17|r>>>15)+o<<0)&(o^e))+s[3]-1044525330)<<22|t>>>10)+r<<0),t=((t+=((e=((e+=(o^t&(r^o))+s[4]-176418897)<<7|e>>>25)+t<<0)^(r=((r+=(t^(o=((o+=(r^e&(t^r))+s[5]+1200080426)<<12|o>>>20)+e<<0)&(e^t))+s[6]-1473231341)<<17|r>>>15)+o<<0)&(o^e))+s[7]-45705983)<<22|t>>>10)+r<<0,t=((t+=((e=((e+=(o^t&(r^o))+s[8]+1770035416)<<7|e>>>25)+t<<0)^(r=((r+=(t^(o=((o+=(r^e&(t^r))+s[9]-1958414417)<<12|o>>>20)+e<<0)&(e^t))+s[10]-42063)<<17|r>>>15)+o<<0)&(o^e))+s[11]-1990404162)<<22|t>>>10)+r<<0,t=((t+=((e=((e+=(o^t&(r^o))+s[12]+1804603682)<<7|e>>>25)+t<<0)^(r=((r+=(t^(o=((o+=(r^e&(t^r))+s[13]-40341101)<<12|o>>>20)+e<<0)&(e^t))+s[14]-1502002290)<<17|r>>>15)+o<<0)&(o^e))+s[15]+1236535329)<<22|t>>>10)+r<<0,t=((t+=((o=((o+=(t^r&((e=((e+=(r^o&(t^r))+s[1]-165796510)<<5|e>>>27)+t<<0)^t))+s[6]-1069501632)<<9|o>>>23)+e<<0)^e&((r=((r+=(e^t&(o^e))+s[11]+643717713)<<14|r>>>18)+o<<0)^o))+s[0]-373897302)<<20|t>>>12)+r<<0,t=((t+=((o=((o+=(t^r&((e=((e+=(r^o&(t^r))+s[5]-701558691)<<5|e>>>27)+t<<0)^t))+s[10]+38016083)<<9|o>>>23)+e<<0)^e&((r=((r+=(e^t&(o^e))+s[15]-660478335)<<14|r>>>18)+o<<0)^o))+s[4]-405537848)<<20|t>>>12)+r<<0,t=((t+=((o=((o+=(t^r&((e=((e+=(r^o&(t^r))+s[9]+568446438)<<5|e>>>27)+t<<0)^t))+s[14]-1019803690)<<9|o>>>23)+e<<0)^e&((r=((r+=(e^t&(o^e))+s[3]-187363961)<<14|r>>>18)+o<<0)^o))+s[8]+1163531501)<<20|t>>>12)+r<<0,t=((t+=((o=((o+=(t^r&((e=((e+=(r^o&(t^r))+s[13]-1444681467)<<5|e>>>27)+t<<0)^t))+s[2]-51403784)<<9|o>>>23)+e<<0)^e&((r=((r+=(e^t&(o^e))+s[7]+1735328473)<<14|r>>>18)+o<<0)^o))+s[12]-1926607734)<<20|t>>>12)+r<<0,t=((t+=((i=(o=((o+=((n=t^r)^(e=((e+=(n^o)+s[5]-378558)<<4|e>>>28)+t<<0))+s[8]-2022574463)<<11|o>>>21)+e<<0)^e)^(r=((r+=(i^t)+s[11]+1839030562)<<16|r>>>16)+o<<0))+s[14]-35309556)<<23|t>>>9)+r<<0,t=((t+=((i=(o=((o+=((n=t^r)^(e=((e+=(n^o)+s[1]-1530992060)<<4|e>>>28)+t<<0))+s[4]+1272893353)<<11|o>>>21)+e<<0)^e)^(r=((r+=(i^t)+s[7]-155497632)<<16|r>>>16)+o<<0))+s[10]-1094730640)<<23|t>>>9)+r<<0,t=((t+=((i=(o=((o+=((n=t^r)^(e=((e+=(n^o)+s[13]+681279174)<<4|e>>>28)+t<<0))+s[0]-358537222)<<11|o>>>21)+e<<0)^e)^(r=((r+=(i^t)+s[3]-722521979)<<16|r>>>16)+o<<0))+s[6]+76029189)<<23|t>>>9)+r<<0,t=((t+=((i=(o=((o+=((n=t^r)^(e=((e+=(n^o)+s[9]-640364487)<<4|e>>>28)+t<<0))+s[12]-421815835)<<11|o>>>21)+e<<0)^e)^(r=((r+=(i^t)+s[15]+530742520)<<16|r>>>16)+o<<0))+s[2]-995338651)<<23|t>>>9)+r<<0,t=((t+=((o=((o+=(t^((e=((e+=(r^(t|~o))+s[0]-198630844)<<6|e>>>26)+t<<0)|~r))+s[7]+1126891415)<<10|o>>>22)+e<<0)^((r=((r+=(e^(o|~t))+s[14]-1416354905)<<15|r>>>17)+o<<0)|~e))+s[5]-57434055)<<21|t>>>11)+r<<0,t=((t+=((o=((o+=(t^((e=((e+=(r^(t|~o))+s[12]+1700485571)<<6|e>>>26)+t<<0)|~r))+s[3]-1894986606)<<10|o>>>22)+e<<0)^((r=((r+=(e^(o|~t))+s[10]-1051523)<<15|r>>>17)+o<<0)|~e))+s[1]-2054922799)<<21|t>>>11)+r<<0,t=((t+=((o=((o+=(t^((e=((e+=(r^(t|~o))+s[8]+1873313359)<<6|e>>>26)+t<<0)|~r))+s[15]-30611744)<<10|o>>>22)+e<<0)^((r=((r+=(e^(o|~t))+s[6]-1560198380)<<15|r>>>17)+o<<0)|~e))+s[13]+1309151649)<<21|t>>>11)+r<<0,t=((t+=((o=((o+=(t^((e=((e+=(r^(t|~o))+s[4]-145523070)<<6|e>>>26)+t<<0)|~r))+s[11]-1120210379)<<10|o>>>22)+e<<0)^((r=((r+=(e^(o|~t))+s[2]+718787259)<<15|r>>>17)+o<<0)|~e))+s[9]-343485551)<<21|t>>>11)+r<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=r-1732584194<<0,this.h3=o+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+r<<0,this.h3=this.h3+o<<0)},Md5.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,o=this.h3;return HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,o=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&o,o>>8&255,o>>16&255,o>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var e,t,r,o="",n=this.array(),i=0;i<15;)e=n[i++],t=n[i++],r=n[i++],o+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[63&(e<<4|t>>>4)]+BASE64_ENCODE_CHAR[63&(t<<2|r>>>6)]+BASE64_ENCODE_CHAR[63&r];return e=n[i],o+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[e<<4&63]+"=="};var exports=createMethod();COMMON_JS?module.exports=exports:root.md5=exports}()})),defaultOptions={url:"https://monitorapi.voicenter.co.il/monitorAPI/getMonitorUrls",fallbackServer:{Domain:"monitor5.voicenter.co.il",Priority:0},loginUrl:"https://loginapi.voicenter.co.il/monitorAPI/Login",refreshTokenUrl:"https://loginapi.voicenter.co.il/monitorAPI/RefreshIdentityToken",servers:defaultServers,token:null,loginType:"token",forceNew:!0,reconnectionDelay:1e4,reconnectionDelayMax:1e4,maxReconnectAttempts:2,timeout:1e4,keepAliveTimeout:6e4,idleInterval:3e5,protocol:"https",transports:["websocket"],upgrade:!1,store:null,extensionsModuleName:"sdkExtensions",queuesModuleName:"sdkQueues",serverFetchStrategy:"remote",serverType:null},allConnections=[],listenersMap=new Map,EventsSDK=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,e),this.options=Object.assign({},defaultOptions,t),this.argumentOptions=Object.assign({},t),!this.options.loginType)throw new Error("A login type should be provided");this.Logger=new Logger(this.options),this.servers=[],this.server=null,this.socket=null,this.connected=!1,this.connectionEstablished=!1,this._lastEventTimestamp=(new Date).getTime(),this._initReconnectOptions(),this._listenersMap=listenersMap,this._retryConnection=debounce_1(this._connect.bind(this),this.reconnectOptions.reconnectionDelay,{leading:!0,trailing:!1}),this._lastLoginTimestamp=null,this._handleLocalEvents=!1,this._registerExtensionsModule(),this._registerQueueModule()}return _createClass(e,[{key:"getLastEventTimestamp",value:function(){return this._lastEventTimestamp}},{key:"_reSync",value:function(){this.emit(eventTypes.RESYNC,{cache:!1})}},{key:"_registerExtensionsModule",value:function(){var e=this.options.extensionsModuleName||"sdkExtensions";this._validateStoreModule(e)&&(this.options.store.registerModule(e,extensionsModule),this._handleLocalEvents=!0)}},{key:"_registerQueueModule",value:function(){var e=this.options.queuesModuleName||"sdkQueues";this._validateStoreModule(e)&&(this.options.store.registerModule(e,queuesModule),this._handleLocalEvents=!0)}},{key:"_validateStoreModule",value:function(e){var t=this.options.store;return!!t&&(t.state[e]&&t.unregisterModule(e),!0)}},{key:"_initReconnectOptions",value:function(){this.reconnectOptions={retryCount:1,maxReconnectAttempts:this.options.maxReconnectAttempts,reconnectionDelay:this.options.reconnectionDelay,minReconnectionDelay:this.options.reconnectionDelay,maxReconnectionDelay:3e5}}},{key:"_onConnect",value:function(){this._initReconnectDelays(),this.connected=!0,this.Logger.log(eventTypes.CONNECT,this.reconnectOptions)}},{key:"_initReconnectDelays",value:function(){this.reconnectOptions.retryCount=1;var e=this.reconnectOptions.minReconnectionDelay;this.reconnectOptions.reconnectionDelay=e,this.socket.io.reconnectionDelay(e),this.socket.io.reconnectionDelayMax(e)}},{key:"_onConnectError",value:function(e){this._retryConnection("next"),this.connected=!1,this.Logger.log(eventTypes.CONNECT_ERROR,e)}},{key:"_onError",value:function(e){this.Logger.log(eventTypes.ERROR,e)}},{key:"_onReconnectFailed",value:function(){this._retryConnection("next"),this.Logger.log(eventTypes.RECONNECT_FAILED,this.reconnectOptions)}},{key:"_onConnectTimeout",value:function(){this._retryConnection("next"),this.Logger.log(eventTypes.CONNECT_TIMEOUT,this.reconnectOptions)}},{key:"_onReconnectAttempt",value:function(){if(this.reconnectOptions.retryCount>=this.reconnectOptions.maxReconnectAttempts)this._retryConnection("next");else{if(this.reconnectOptions.reconnectionDelay<this.reconnectOptions.maxReconnectionDelay){var e=this.reconnectOptions.minReconnectionDelay*this.reconnectOptions.retryCount;this.reconnectOptions.reconnectionDelay=e,this.socket.io.reconnectionDelay(e),this.socket.io.reconnectionDelayMax(e)}this.reconnectOptions.retryCount++,this.Logger.log(eventTypes.RECONNECT_ATTEMPT,this.reconnectOptions)}}},{key:"_onDisconnect",value:function(e){this.connected=!1,this.Logger.log(eventTypes.DISCONNECT,e),this._connect("next")}},{key:"_onKeepAlive",value:function(e){("object"!==_typeof(e)||0===e.errorCode)&&e&&this.connected?(this.Logger.log(eventTypes.KEEP_ALIVE_RESPONSE),this._lastEventTimestamp=(new Date).getTime()):this._initSocketConnection()}},{key:"_onLoginResponse",value:async function(e){e.URL&&(this.server={Priority:0,Domain:e.URL.replace("https://","")}),e.URLList&&Array.isArray(e.URLList)&&(this.servers=e.URLList.map((function(e,t){return{Priority:t,Domain:e.replace("https://","")}}))),e.Token&&(this.options.token=e.Token,this.token=e.Token,await this._connect("default",!0)),e.RefreshToken&&(this.options.refreshToken=e.RefreshToken,this._handleTokenExpiry()),e.TokenExpiry&&(this.options.tokenExpiry=e.TokenExpiry)}},{key:"_handleTokenExpiry",value:function(){var e=this,t=new Date(this.options.tokenExpiry);if(isValidDate(t)){var r=t.getTime()-(new Date).getTime()-5e3;setTimeout((async function(){var t=await refreshToken(e.options.refreshTokenUrl,e.options.refreshToken);await e._onLoginResponse(t)}),r)}}},{key:"_parsePacket",value:function(e){return e.data?{name:e.data[0],data:e.data[1]}:{}}},{key:"_connect",value:async function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null;if("default"===e)r=this._findCurrentServer();else if("next"===e)r=this._findNextAvailableServer();else{if("prev"!==e)throw new Error("Incorrect 'server' parameter passed to connect function ".concat(e,". Should be 'default' or 'next'"));r=this._findMaxPriorityServer()}r||(this.server=this._findCurrentServer()),this._initSocketConnection(),this._initSocketEvents(),this._initKeepAlive(),this._initReconnectDelays(),t||await this.login(this.options.loginType)}},{key:"_checkInit",value:function(){if(!this.connectionEstablished)throw new Error('Make sure you call "sdk.init()" before doing other operations.')}},{key:"_initSocketConnection",value:function(){var e=this.server.Domain,t=this.options.protocol,r="".concat(t,"://").concat(e);this.Logger.log("Connecting to..",r),this.closeAllConnections();var o=Object.assign({},this.options,{debug:!1});this.token&&(o.query={token:this.token}),this.socket=io(r,o),allConnections.push(this.socket),this.connectionEstablished=!0}},{key:"_initSocketEvents",value:function(){this.socket.onevent=this._onEvent.bind(this)}},{key:"_initKeepAlive",value:function(){var e=this;this.keepAliveInterval&&clearInterval(this.keepAliveInterval),this.idleInterval&&clearInterval(this.idleInterval),this.keepAliveInterval=setInterval((async function(){var t=(new Date).getTime(),r=2*e.options.keepAliveTimeout;t>e.getLastEventTimestamp()+r?await e._connect("next",!0):e.socket?t>e.getLastEventTimestamp()+e.options.keepAliveTimeout&&e.emit(eventTypes.KEEP_ALIVE,e.options.token):e._initSocketConnection()}),this.options.keepAliveTimeout),this.idleInterval=setInterval((function(){e.reSync(!1)}),this.options.idleInterval)}},{key:"_findCurrentServer",value:function(){var e=null;return this.servers.length&&(e=this.servers[0]),this.server=e,this.server||(this.server=this.options.fallbackServer),this.server}},{key:"_findNextAvailableServer",value:function(){var e=this.server.Priority;if(this.Logger.log("Failover -> Trying to find another server"),e===this.servers.length-1)return this._findMaxPriorityServer();var t=e+1,r=this.servers.find((function(e){return e.Priority===t}));return r||(r=this._findMaxPriorityServer())?this.server.Domain!==r.Domain?(this.server=r,this.server):(this.Logger.log("Failover -> Found new server. Connecting to it...",this.server),null):void 0}},{key:"_findMaxPriorityServer",value:function(){this.Logger.log("Fallback -> Trying to find previous server","_findMaxPriorityServer");var e=getServerWithHighestPriority(this.servers);return this.server?this.server&&e.Domain!==this.server.Domain?(this.server=e,this.Logger.log("Fallback -> Trying to find previous server",this.server),this.server):null:(this.server=e,this.server)}},{key:"_getServers",value:async function(){"static"===this.options.serverFetchStrategy&&this.argumentOptions.servers&&Array.isArray(this.argumentOptions.servers)&&this.argumentOptions.servers.length>1&&(this.servers=this.argumentOptions.servers)}},{key:"_onEvent",value:function(e){var t,r=this;if(e.data){var o=this._parsePacket(e);this.Logger.log("New event -> ".concat(o.name),o),this._lastEventTimestamp=(new Date).getTime(),this._listenersMap.forEach((function(e,t){("*"===t||o.name===t)&&e(o)}));var n=(_defineProperty(t={},eventTypes.RECONNECT_ATTEMPT,this._onReconnectAttempt),_defineProperty(t,eventTypes.RECONNECT_FAILED,this._onReconnectFailed),_defineProperty(t,eventTypes.CONNECT,this._onConnect),_defineProperty(t,eventTypes.DISCONNECT,this._onDisconnect),_defineProperty(t,eventTypes.ERROR,this._onError),_defineProperty(t,eventTypes.CONNECT_ERROR,this._onConnectError),_defineProperty(t,eventTypes.CONNECT_TIMEOUT,this._onConnectTimeout),_defineProperty(t,eventTypes.KEEP_ALIVE_RESPONSE,this._onKeepAlive),_defineProperty(t,eventTypes.LOGIN_RESPONSE,this._onLoginResponse),_defineProperty(t,eventTypes.EXTENSION_UPDATED,this._reSync),_defineProperty(t,eventTypes.QUEUES_UPDATED,this._reSync),_defineProperty(t,eventTypes.DIALERS_UPDATED,this._reSync),_defineProperty(t,eventTypes.LOGIN_STATUS,(function(){r.connected||r._onConnect()})),t)[o.name];n&&"function"==typeof n&&n.call(this,o.data),this._handleLocalEvents&&onNewEvent(Object.assign({eventData:o},this.options))}}},{key:"init",value:async function(){return this.connectionEstablished||(this.socket&&this.emit(eventTypes.CLOSE),await this._getToken(),await this.login(this.options.loginType),await this._getServers()),!0}},{key:"setToken",value:function(e){return this.options.token=e,this.disconnect(),this.init()}},{key:"closeAllConnections",value:function(){allConnections.forEach((function(e){e.close(),e.disconnect()})),allConnections=[],this.socket&&(this.socket.disconnect(),this.socket=null)}},{key:"disconnect",value:function(){this._listenersMap=new Map,this.closeAllConnections()}},{key:"on",value:function(e,t){this._listenersMap.set(e,t),this._checkInit()}},{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkInit(),this.Logger.log("EMIT -> ".concat(e),t),this.socket.emit(e,t)}},{key:"reSync",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.emit(eventTypes.RESYNC,{cache:e})}},{key:"setMonitorUrl",value:async function(e){var t=this.options.url,r=this.options.serverFetchStrategy;try{if(!e)return;this.options.url=e,this.options.serverFetchStrategy="remote"}catch(e){this._onError(e),this.options.url=t,this.options.serverFetchStrategy=r}await this.init()}},{key:"_getToken",value:function(){var e=this.options.loginType;if(this.token=this.options.token,"token"===e&&!this.token)throw new Error("Token login type expects the token option to be provided")}},{key:"_getTabsSession",value:function(){return window.sessionStorage.length||localStorage.setItem("getSessionStorage",Date.now()),window.addEventListener("storage",(function(e){if("getSessionStorage"===e.key)localStorage.setItem("sessionStorage",JSON.stringify(window.sessionStorage)),localStorage.removeItem("sessionStorage");else if("sessionStorage"===e.key&&!sessionStorage.length){var t=JSON.parse(e.newValue);for(var r in t)window.sessionStorage.setItem(r,t[r])}})),new Promise((function(e){return setTimeout(e,200)}))}},{key:"login",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"token",r={token:this.options.token,email:this.options.email,username:this.options.username,password:this.options.password},o=(md5(JSON.stringify(r)),1e3);return this._lastLoginTimestamp+o>(new Date).getTime()?Promise.resolve():(this._lastLoginTimestamp=(new Date).getTime(),new Promise((async function(o,n){try{var i=getExternalLoginUrl(e.options.loginUrl,t),s=await externalLogin(i,r);return await e._onLoginResponse(s),o(s)}catch(t){return e.servers=e.argumentOptions.servers||defaultServers,n(t)}})))}}]),e}();return EventsSDK}));
//# sourceMappingURL=voicenter-events-sdk.umd.js.map
